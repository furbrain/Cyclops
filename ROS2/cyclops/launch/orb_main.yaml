launch:
  - arg:
      name: orb_exec
      default: "rgbd_inertial"
  - arg:
      name: ros_home
      default: '$(env ROS_HOME "$(env HOME)/.ros")'
  - arg:
      name: ns
      default: ''
  - arg:
      name: log_level
      default: 'INFO'

  - node:
      pkg: orb_slam3
      exec: "ros_$(var orb_exec)"
      namespace: orb
      name: ORB
      output: screen
      args: "--ros-args --log-level ORB:=$(var log_level)"
      param:
        - name: settings_file
          value: "$(var ros_home)/orb_slam3.yaml"
        - name: voc_file
          value: "$(find-pkg-share orb_slam3)/vocab/ORBvoc.txt.bin"
        - name: world_frame_id
          value: map
        - name: cam_frame_id
          value: rgb
        - name: imu_frame_id
          value: base_link
#        - name: lost_images_path
#          value: /home/pi/lost/
      remap:
        - from: /camera/rgb/image_raw
          to: /rgb/image_rect
        - from: /camera/depth_registered/image_raw
          to: /rgb/depth_registered
        - from: /imu
          to: /imu/imu_madg

  - node:
      pkg: cyclops_cpp
      exec: register_node
      name: register
      namespace: "$(var ns)/tof"
      param:
        - name: radial_source
          value: True
        - name: rectified_source
          value: False
        - name: rectified_dest
          value: False
        - name: fill_upsampling_holes
          value: True
      remap:
        - from: rgb/camera_info
          to: "$(var ns)/rgb/camera_info"
        - from: depth/image_rect
          to: depth_raw
        - from: depth/camera_info
          to: camera_info
        - from: depth_registered/image_rect
          to: "$(var ns)/rgb/depth_registered"

  - node:
      pkg: image_proc
      exec: rectify_node
      name: rectify
      namespace: "$(var ns)/rgb"
      remap:
        - from: image
          to: image_raw

  - node:
      pkg: imu_filter_madgwick
      exec: imu_filter_madgwick_node
      namespace: "$(var ns)/imu"
      name: madgwick
      remap:
        - from: imu/data_raw
          to: imu_rect
        - from: imu/mag
          to: "$(var ns)/imu/mag_rect"
        - from: imu/data
          to: "$(var ns)/imu/imu_madg"
      param:
        - name: use_mag
          value: true
        - name: publish_tf
          value: true
        - name: fixed_frame
          value: madg_odom
        - name: reverse_tf
          value: true

  - node:
      pkg: cyclops
      exec: orb_state_beeper
      name: orb_beeper
      namespace: $(var ns)/orb
      remap:
        - from: state
          to: $(var ns)/orb/ORB/state
        - from: preset
          to: $(var ns)/beeper/preset